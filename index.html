<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gaming Checklist</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .container {
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            padding: 40px;
            max-width: 500px;
            width: 100%;
        }

        h1 {
            text-align: center;
            color: #333;
            margin-bottom: 30px;
            font-size: 28px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .header {
            position: relative;
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
        }

        .settings-btn {
            width: 40px;
            height: 40px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            transition: all 0.3s ease;
            box-shadow: 0 2px 10px rgba(102, 126, 234, 0.3);
        }

        .settings-btn:hover {
            transform: rotate(90deg) scale(1.1);
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.5);
        }

        .settings-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            justify-content: center;
            align-items: center;
            z-index: 200;
        }

        .settings-modal.active {
            display: flex;
        }

        .settings-content {
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
            max-width: 400px;
            max-height: 80vh;
            overflow-y: auto;
            width: 90%;
        }

        .settings-content h2 {
            color: #333;
            margin-bottom: 20px;
            font-size: 22px;
        }

        .settings-item {
            margin-bottom: 20px;
            padding-bottom: 20px;
            border-bottom: 1px solid #e9ecef;
        }

        .settings-item:last-child {
            border-bottom: none;
        }

        .settings-item label {
            display: block;
            color: #333;
            font-weight: 600;
            margin-bottom: 8px;
            font-size: 14px;
        }

        .settings-item input[type="number"] {
            width: 100%;
            padding: 10px;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.3s ease;
        }

        .settings-item input[type="number"]:focus {
            outline: none;
            border-color: #667eea;
        }

        .settings-buttons {
            display: flex;
            gap: 10px;
            justify-content: center;
            margin-top: 20px;
        }

        .settings-buttons button {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .btn-settings-save {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            flex: 1;
        }

        .btn-settings-save:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        .btn-settings-cancel {
            background: #e9ecef;
            color: #333;
            flex: 1;
        }

        .btn-settings-cancel:hover {
            background: #dee2e6;
        }

        .checklist {
            list-style: none;
        }

        .checklist-item {
            display: flex;
            align-items: center;
            padding: 15px;
            margin-bottom: 10px;
            background: #f8f9fa;
            border-radius: 10px;
            transition: all 0.3s ease;
            cursor: pointer;
        }

            .checklist-item:hover {
                background: #e9ecef;
                transform: translateX(5px);
            }

            .checklist-item.active {
                background: #d4e4ff;
                border: 2px solid #667eea;
                box-shadow: 0 0 10px rgba(102, 126, 234, 0.3);
                transform: translateX(5px);
            }

            .checklist-item input[type="checkbox"] {
                width: 20px;
                height: 20px;
                cursor: pointer;
                accent-color: #667eea;
                margin-right: 15px;
                flex-shrink: 0;
            }

            .checklist-item-content {
                flex-grow: 1;
                display: flex;
                align-items: center;
                cursor: pointer;
                user-select: none;
            }

            .checklist-item label {
                cursor: pointer;
                flex-grow: 1;
                font-size: 16px;
                color: #333;
                transition: all 0.3s ease;
                user-select: none;
            }

            .checklist-item input[type="checkbox"]:checked + .checklist-item-content label {
                color: #999;
                text-decoration: line-through;
            }

        .time-info {
            display: flex;
            align-items: center;
            gap: 12px;
            flex-shrink: 0;
        }

        .timer-display {
            font-size: 14px;
            color: #667eea;
            font-weight: 600;
            min-width: 50px;
            text-align: right;
            font-family: 'Courier New', monospace;
        }

        .checklist-item.active .timer-display {
            animation: pulse 1s infinite;
        }

        @keyframes pulse {
            0%, 100% {
                opacity: 1;
            }
            50% {
                opacity: 0.6;
            }
        }

        .info-icon {
            width: 24px;
            height: 24px;
            background: #667eea;
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
            font-weight: bold;
            cursor: pointer;
            position: relative;
            transition: all 0.3s ease;
        }

            .info-icon:hover {
                background: #764ba2;
                transform: scale(1.1);
            }

        .tooltip {
            position: absolute;
            bottom: 100%;
            right: 0;
            background: #333;
            color: white;
            padding: 8px 12px;
            border-radius: 6px;
            font-size: 13px;
            white-space: normal;
            margin-bottom: 8px;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
            pointer-events: none;
            z-index: 10;
            max-width: 150px;
            line-height: 1.4;
        }

            .tooltip::after {
                content: '';
                position: absolute;
                top: 100%;
                right: 8px;
                border: 4px solid transparent;
                border-top-color: #333;
            }

        .info-icon:hover .tooltip {
            opacity: 1;
            visibility: visible;
        }

        .progress {
            margin-top: 30px;
            padding-top: 20px;
            border-top: 2px solid #e9ecef;
        }

        .progress-bar {
            width: 100%;
            height: 8px;
            background: #e9ecef;
            border-radius: 10px;
            overflow: hidden;
            margin-bottom: 10px;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
            transition: width 0.3s ease;
            width: 0%;
        }

        .progress-text {
            text-align: center;
            color: #666;
            font-size: 14px;
            font-weight: 500;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            justify-content: center;
            align-items: center;
            z-index: 100;
        }

            .modal.active {
                display: flex;
            }

        .modal-content {
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
            text-align: center;
            max-width: 300px;
        }

            .modal-content h2 {
                color: #333;
                margin-bottom: 20px;
                font-size: 20px;
            }

            .modal-content input[type="number"] {
                width: 100%;
                padding: 10px;
                border: 2px solid #e9ecef;
                border-radius: 8px;
                font-size: 16px;
                margin-bottom: 15px;
                transition: border-color 0.3s ease;
            }

                .modal-content input[type="number"]:focus {
                    outline: none;
                    border-color: #667eea;
                }

        .modal-buttons {
            display: flex;
            gap: 10px;
            justify-content: center;
        }

            .modal-buttons button {
                padding: 10px 20px;
                border: none;
                border-radius: 8px;
                font-size: 14px;
                cursor: pointer;
                font-weight: 600;
                transition: all 0.3s ease;
            }

        .btn-save {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

            .btn-save:hover {
                transform: translateY(-2px);
                box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
            }

        .btn-cancel {
            background: #e9ecef;
            color: #333;
        }

        .btn-cancel:hover {
            background: #dee2e6;
        }

        .challenge-timer {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px 30px;
            border-radius: 20px;
            box-shadow: 0 10px 40px rgba(102, 126, 234, 0.4);
            z-index: 50;
            min-width: 150px;
            text-align: center;
        }

        .challenge-timer-label {
            font-size: 12px;
            font-weight: 600;
            opacity: 0.9;
            margin-bottom: 8px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .challenge-timer-display {
            font-size: 48px;
            font-weight: 700;
            font-family: 'Courier New', monospace;
            line-height: 1;
            margin-bottom: 8px;
            text-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
        }

        .challenge-timer-running {
            /* Animation entfernt */
        }

        .challenge-timer-controls {
            display: flex;
            gap: 8px;
            justify-content: center;
            margin-top: 10px;
        }

        .challenge-timer-btn {
            width: 32px;
            height: 32px;
            border: none;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.2);
            color: white;
            cursor: pointer;
            font-size: 16px;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
        }

        .challenge-timer-btn:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: scale(1.1);
        }

        @media (max-width: 600px) {
            .challenge-timer {
                bottom: 10px;
                right: 10px;
                padding: 15px 20px;
                min-width: 120px;
            }

            .challenge-timer-display {
                font-size: 36px;
            }

            .challenge-timer-label {
                font-size: 10px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>🎮 Gaming Checklist</h1>
            <button class="settings-btn" onclick="openSettingsModal()" title="Einstellungen">⚙️</button>
        </div>
        <ul class="checklist" id="checklist">
            <li class="checklist-item">
                <input type="checkbox" id="item1">
                <div class="checklist-item-content">
                    <label for="item1">Valo B2B</label>
                    <div class="time-info">
                        <span class="timer-display">0:00:00</span>
                        <div class="info-icon">
                            i
                            <div class="tooltip" data-planned="3h">Geplant: 3h</div>
                        </div>
                    </div>
                </div>
            </li>
            <li class="checklist-item">
                <input type="checkbox" id="item2">
                <div class="checklist-item-content">
                    <label for="item2">LoL B3B</label>
                    <div class="time-info">
                        <span class="timer-display">0:00:00</span>
                        <div class="info-icon">
                            i
                            <div class="tooltip" data-planned="5h">Geplant: 5h</div>
                        </div>
                    </div>
                </div>
            </li>
            <li class="checklist-item">
                <input type="checkbox" id="item3">
                <div class="checklist-item-content">
                    <label for="item3">Paladins B3B</label>
                    <div class="time-info">
                        <span class="timer-display">0:00:00</span>
                        <div class="info-icon">
                            i
                            <div class="tooltip" data-planned="2h">Geplant: 2h</div>
                        </div>
                    </div>
                </div>
            </li>
            <li class="checklist-item">
                <input type="checkbox" id="item4">
                <div class="checklist-item-content">
                    <label for="item4">Hell let Loose 1 W</label>
                    <div class="time-info">
                        <span class="timer-display">0:00:00</span>
                        <div class="info-icon">
                            i
                            <div class="tooltip" data-planned="2h">Geplant: 2h</div>
                        </div>
                    </div>
                </div>
            </li>
            <li class="checklist-item">
                <input type="checkbox" id="item5">
                <div class="checklist-item-content">
                    <label for="item5">Rainbow B2B</label>
                    <div class="time-info">
                        <span class="timer-display">0:00:00</span>
                        <div class="info-icon">
                            i
                            <div class="tooltip" data-planned="4h">Geplant: 4h</div>
                        </div>
                    </div>
                </div>
            </li>
            <li class="checklist-item">
                <input type="checkbox" id="item6">
                <div class="checklist-item-content">
                    <label for="item6">Minecraft Enderdrachen ohne sterben</label>
                    <div class="time-info">
                        <span class="timer-display">0:00:00</span>
                        <div class="info-icon">
                            i
                            <div class="tooltip" data-planned="3h">Geplant: 3h</div>
                        </div>
                    </div>
                </div>
            </li>
            <li class="checklist-item">
                <input type="checkbox" id="item7">
                <div class="checklist-item-content">
                    <label for="item7">Are You There Yet</label>
                    <div class="time-info">
                        <span class="timer-display">0:00:00</span>
                        <div class="info-icon">
                            i
                            <div class="tooltip" data-planned="5h">Geplant: 5h</div>
                        </div>
                    </div>
                </div>
            </li>
            <li class="checklist-item">
                <input type="checkbox" id="item8">
                <div class="checklist-item-content">
                    <label for="item8">Fall Guys 1 Win</label>
                    <div class="time-info">
                        <span class="timer-display">0:00:00</span>
                        <div class="info-icon">
                            i
                            <div class="tooltip" data-planned="2h">Geplant: 2h</div>
                        </div>
                    </div>
                </div>
            </li>
        </ul>

        <div class="progress">
            <div class="progress-bar">
                <div class="progress-fill" id="progressFill"></div>
            </div>
            <div class="progress-text">
                <span id="completedCount">0</span> / <span id="totalCount">8</span> abgehakt
            </div>
        </div>
    </div>

    <div class="challenge-timer" id="challengeTimer">
        <div class="challenge-timer-label">Challenge Timer</div>
        <div class="challenge-timer-display" id="challengeTimerDisplay">0:00:00</div>
        <div class="challenge-timer-controls">
            <button class="challenge-timer-btn" onclick="toggleChallengeTimer()" id="challengeTimerToggleBtn" title="Start/Stop">▶</button>
            <button class="challenge-timer-btn" onclick="resetChallengeTimer()" title="Reset">↻</button>
        </div>
    </div>

    <div class="settings-modal" id="settingsModal">
        <div class="settings-content">
            <h2>Einstellungen</h2>
            <div id="settingsItems"></div>
            <div class="settings-buttons">
                <button class="btn-settings-save" onclick="saveSettings()">Speichern</button>
                <button class="btn-settings-cancel" onclick="closeSettingsModal()">Abbrechen</button>
            </div>
        </div>
    </div>

    <div class="modal" id="timeModal">
        <div class="modal-content">
            <h2>Zeit bestätigen</h2>
            <p id="timerConfirm" style="font-size: 24px; color: #667eea; margin: 20px 0; font-weight: bold; font-family: 'Courier New', monospace;">0:00:00</p>
            <div class="modal-buttons">
                <button class="btn-save" onclick="confirmTimerTime()">Bestätigen</button>
                <button class="btn-cancel" onclick="closeModal()">Abbrechen</button>
            </div>
        </div>
    </div>

    <script>
        const checkboxes = document.querySelectorAll('.checklist input[type="checkbox"]');
        const progressFill = document.getElementById('progressFill');
        const completedCount = document.getElementById('completedCount');
        const totalCount = document.getElementById('totalCount');
        const timeModal = document.getElementById('timeModal');
        const timerConfirm = document.getElementById('timerConfirm');
        
        let activeItemIndex = null;
        let timerRunning = false;
        let timerInterval = null;
        let elapsedSeconds = {};
        let currentItemIndexForModal = null;
        let challengeElapsedSeconds = 0;
        let challengeTimerRunning = false;

        // Initialisiere Zeittracking
        checkboxes.forEach((checkbox, index) => {
            elapsedSeconds[index] = 0;
        });

        // Formatiere Sekunden zu HH:MM:SS
        function formatTime(seconds) {
            const hours = Math.floor(seconds / 3600);
            const minutes = Math.floor((seconds % 3600) / 60);
            const secs = seconds % 60;
            return `${String(hours).padStart(2, '0')}:${String(minutes).padStart(2, '0')}:${String(secs).padStart(2, '0')}`;
        }

        // Konvertiere Sekunden zu Dezimalstunden
        function secondsToHours(seconds) {
            return (seconds / 3600).toFixed(2);
        }

        // Challenge Timer Funktionen
        function updateChallengeTimerDisplay() {
            const display = document.getElementById('challengeTimerDisplay');
            display.textContent = formatTime(challengeElapsedSeconds);
        }

        function toggleChallengeTimer() {
            challengeTimerRunning = !challengeTimerRunning;
            const btn = document.getElementById('challengeTimerToggleBtn');
            const timer = document.getElementById('challengeTimer');

            if (challengeTimerRunning) {
                btn.textContent = '⏸';
                btn.title = 'Pause';
                timer.classList.add('challenge-timer-running');
                localStorage.setItem('challenge-timer-running', 'true');

                // Starte den globalen Timer
                startGlobalTimer();
            } else {
                btn.textContent = '▶';
                btn.title = 'Start';
                timer.classList.remove('challenge-timer-running');
                localStorage.setItem('challenge-timer-running', 'false');
            }
        }

        function startGlobalTimer() {
            if (timerInterval) {
                clearInterval(timerInterval);
            }
            
            timerInterval = setInterval(() => {
                if (challengeTimerRunning) {
                    challengeElapsedSeconds++;
                    updateChallengeTimerDisplay();
                    localStorage.setItem('challenge-timer-seconds', challengeElapsedSeconds);
                }
                
                if (timerRunning && activeItemIndex !== null) {
                    elapsedSeconds[activeItemIndex]++;
                    updateTimerDisplay(activeItemIndex);
                    localStorage.setItem(`item-${activeItemIndex}-elapsed-seconds`, elapsedSeconds[activeItemIndex]);
                }
                
                // Stoppe den Interval wenn beide Timer inaktiv sind
                if (!challengeTimerRunning && !timerRunning) {
                    clearInterval(timerInterval);
                    timerInterval = null;
                }
            }, 1000);
        }

        function resetChallengeTimer() {
            challengeElapsedSeconds = 0;
            challengeTimerRunning = false;
            const btn = document.getElementById('challengeTimerToggleBtn');
            const timer = document.getElementById('challengeTimer');
            btn.textContent = '▶';
            btn.title = 'Start';
            timer.classList.remove('challenge-timer-running');
            updateChallengeTimerDisplay();
            localStorage.setItem('challenge-timer-seconds', '0');
            localStorage.setItem('challenge-timer-running', 'false');
            
            // Stoppe Interval wenn nötig
            if (timerInterval && !timerRunning) {
                clearInterval(timerInterval);
                timerInterval = null;
            }
        }

        // Starte oder stoppe Timer
        function toggleTimer(index) {
            if (activeItemIndex === index) {
                // Stoppe Timer für gleiches Item
                timerRunning = false;
                document.querySelectorAll('.checklist-item')[index].classList.remove('active');
                activeItemIndex = null;
                localStorage.removeItem('active-timer-index');
                localStorage.setItem('timer-running', 'false');
                return;
            }

            // Stoppe vorherigen Timer
            if (activeItemIndex !== null) {
                timerRunning = false;
                document.querySelectorAll('.checklist-item')[activeItemIndex].classList.remove('active');
            }

            // Starte neuen Timer
            activeItemIndex = index;
            document.querySelectorAll('.checklist-item')[index].classList.add('active');
            timerRunning = true;
            
            // Speichere aktiven Timer
            localStorage.setItem('active-timer-index', index);
            localStorage.setItem('timer-running', 'true');

            // Starte den globalen Timer
            startGlobalTimer();
        }

        // Aktualisiere Timer-Anzeige
        function updateTimerDisplay(index) {
            const timerDisplay = document.querySelectorAll('.timer-display')[index];
            timerDisplay.textContent = formatTime(elapsedSeconds[index]);
        }

        // Initialisiere die Zeit-Info für jedes Element
        function initializeTimeInfo() {
            checkboxes.forEach((checkbox, index) => {
                const tooltip = checkbox.parentElement.querySelector('.tooltip');
                const plannedTime = tooltip.getAttribute('data-planned');
                const elapsedTime = localStorage.getItem(`item-${index}-elapsed-seconds`);

                if (elapsedTime) {
                    elapsedSeconds[index] = parseInt(elapsedTime);
                    updateTimerDisplay(index);
                }

                tooltip.textContent = `Geplant: ${plannedTime}`;
            });

            // Lade Challenge Timer
            const savedChallengeSeconds = localStorage.getItem('challenge-timer-seconds');
            const savedChallengeRunning = localStorage.getItem('challenge-timer-running') === 'true';

            if (savedChallengeSeconds) {
                challengeElapsedSeconds = parseInt(savedChallengeSeconds);
                updateChallengeTimerDisplay();
            }

            if (savedChallengeRunning) {
                challengeTimerRunning = true;
                const btn = document.getElementById('challengeTimerToggleBtn');
                const timer = document.getElementById('challengeTimer');
                btn.textContent = '⏸';
                btn.title = 'Pause';
                timer.classList.add('challenge-timer-running');
                startGlobalTimer();
            }

            // Stelle aktiven Timer wieder her
            const savedActiveIndex = localStorage.getItem('active-timer-index');
            const savedTimerRunning = localStorage.getItem('timer-running') === 'true';

            if (savedActiveIndex !== null && savedTimerRunning) {
                const index = parseInt(savedActiveIndex);
                activeItemIndex = index;
                document.querySelectorAll('.checklist-item')[index].classList.add('active');
                timerRunning = true;
                startGlobalTimer();
            }           
        }

        function updateProgress() {
            const checked = document.querySelectorAll('.checklist input[type="checkbox"]:checked').length;
            const total = checkboxes.length;
            const percentage = (checked / total) * 100;

            progressFill.style.width = percentage + '%';
            completedCount.textContent = checked;
        }

        function closeModal() {
            timeModal.classList.remove('active');
            currentItemIndexForModal = null;
        }

        function openSettingsModal() {
            const settingsItems = document.getElementById('settingsItems');
            settingsItems.innerHTML = '';

            // Challenge Timer Section
            const challengeSection = document.createElement('div');
            challengeSection.innerHTML = `
                <div style="margin-bottom: 20px; padding-bottom: 20px; border-bottom: 2px solid #667eea;">
                    <label style="display: block; color: #333; font-weight: 700; margin-bottom: 12px; font-size: 16px;">⏱️ Challenge Timer</label>
                    <input type="number" id="settings-challenge-timer" min="0" step="0.01" value="${(parseInt(localStorage.getItem('challenge-timer-seconds') || '0') / 3600).toFixed(2)}" placeholder="Zeit in Stunden" style="width: 100%; padding: 10px; border: 2px solid #e9ecef; border-radius: 8px; font-size: 16px;">
                </div>
            `;
            settingsItems.appendChild(challengeSection);

            // Item Timers Section
            const itemsLabel = document.createElement('div');
            itemsLabel.style.marginBottom = '15px';
            itemsLabel.innerHTML = '<div style="color: #333; font-weight: 700; font-size: 16px;">🎮 Item Timer</div>';
            settingsItems.appendChild(itemsLabel);

            checkboxes.forEach((checkbox, index) => {
                const label = checkbox.nextElementSibling.querySelector('label');
                const itemName = label.textContent;
                const elapsedSeconds = localStorage.getItem(`item-${index}-elapsed-seconds`) || '0';
                const elapsedHours = (parseInt(elapsedSeconds) / 3600).toFixed(2);

                const itemDiv = document.createElement('div');
                itemDiv.className = 'settings-item';
                itemDiv.innerHTML = `
                    <label for="settings-item-${index}">${itemName}</label>
                    <input type="number" id="settings-item-${index}" min="0" step="0.01" value="${elapsedHours}" placeholder="Timer in Stunden">
                `;
                settingsItems.appendChild(itemDiv);
            });

            document.getElementById('settingsModal').classList.add('active');
        }

        function closeSettingsModal() {
            document.getElementById('settingsModal').classList.remove('active');
        }

        function saveSettings() {
            // Speichere Challenge Timer
            const challengeTimerInput = document.getElementById('settings-challenge-timer');
            if (challengeTimerInput && challengeTimerInput.value !== '') {
                const hours = parseFloat(challengeTimerInput.value);
                const seconds = Math.round(hours * 3600);
                challengeElapsedSeconds = seconds;
                localStorage.setItem('challenge-timer-seconds', seconds);
                updateChallengeTimerDisplay();
            }

            // Speichere Item Timer
            checkboxes.forEach((checkbox, index) => {
                const input = document.getElementById(`settings-item-${index}`);
                if (input && input.value !== '') {
                    const hours = parseFloat(input.value);
                    const seconds = Math.round(hours * 3600);
                    elapsedSeconds[index] = seconds;
                    localStorage.setItem(`item-${index}-elapsed-seconds`, seconds);
                    updateTimerDisplay(index);
                }
            });
            closeSettingsModal();
        }

        function confirmTimerTime() {
            if (currentItemIndexForModal !== null) {
                const seconds = elapsedSeconds[currentItemIndexForModal];
                const hours = secondsToHours(seconds);

                localStorage.setItem(`item-${currentItemIndexForModal}-actual-time`, hours);
                localStorage.setItem(`item-${currentItemIndexForModal}-elapsed-seconds`, seconds);
                
                closeModal();
            }
        }

        function updateTooltip(index) {
            const checkbox = checkboxes[index];
            const tooltip = checkbox.parentElement.querySelector('.tooltip');
            const plannedTime = tooltip.getAttribute('data-planned');

            tooltip.textContent = `Geplant: ${plannedTime}`;
        }

        // Click Handler für Listeneintrag-Content (Label und Timer)
        document.querySelectorAll('.checklist-item-content').forEach((content, index) => {
            content.addEventListener('click', (e) => {
                e.preventDefault();
                toggleTimer(index);
            });
        });

        // Event Listener für Checkboxen
        checkboxes.forEach((checkbox, index) => {
            checkbox.addEventListener('change', () => {
                if (checkbox.checked) {
                    // Stoppe Timer
                    if (activeItemIndex === index) {
                        timerRunning = false;
                        document.querySelectorAll('.checklist-item')[index].classList.remove('active');
                        activeItemIndex = null;
                        localStorage.removeItem('active-timer-index');
                        localStorage.setItem('timer-running', 'false');
                    }

                    // Zeige Modal mit Bestätigung
                    currentItemIndexForModal = index;
                    timerConfirm.textContent = formatTime(elapsedSeconds[index]);
                    timeModal.classList.add('active');
                } else {
                    localStorage.removeItem(`item-${index}-actual-time`);
                    localStorage.removeItem(`item-${index}-elapsed-seconds`);
                    elapsedSeconds[index] = 0;
                    updateTimerDisplay(index);
                    updateTooltip(index);
                }

                localStorage.setItem(`item-${index}`, checkbox.checked);
                updateProgress();
            });
        });

        // Info-Icon Click Handler
        document.querySelectorAll('.info-icon').forEach((icon, index) => {
            icon.addEventListener('click', (e) => {
                e.stopPropagation();
                if (checkboxes[index].checked) {
                    currentItemIndexForModal = index;
                    timerConfirm.textContent = formatTime(elapsedSeconds[index]);
                    timeModal.classList.add('active');
                }
            });
        });

        // Modal schließen bei Klick außerhalb
        timeModal.addEventListener('click', (e) => {
            if (e.target === timeModal) {
                closeModal();
            }
        });

        // Settings-Modal schließen bei Klick außerhalb
        document.getElementById('settingsModal').addEventListener('click', (e) => {
            if (e.target === document.getElementById('settingsModal')) {
                closeSettingsModal();
            }
        });

        // Lade gespeicherte Daten
        checkboxes.forEach((checkbox, index) => {
            checkbox.checked = localStorage.getItem(`item-${index}`) === 'true';
        });

        initializeTimeInfo();
        updateProgress();
    </script>
</body>
</html>